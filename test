a!toJson(
  {
    query: concat(
      "query MyQuery { getEntities(input: {",
      if(
        and(not(isnull(ri!firstName)), len(trim(ri!firstName)) > 0),
        concat("firstName: \"", ri!firstName, "\""),
        ""
      ),
      if(
        and(
          and(not(isnull(ri!firstName)), len(trim(ri!firstName)) > 0),
          and(not(isnull(ri!lastName)), len(trim(ri!lastName)) > 0)
        ),
        ", ",
        ""
      ),
      if(
        and(not(isnull(ri!lastName)), len(trim(ri!lastName)) > 0),
        concat("lastName: \"", ri!lastName, "\""),
        ""
      ),
      if(
        and(
          or(
            and(not(isnull(ri!firstName)), len(trim(ri!firstName)) > 0),
            and(not(isnull(ri!lastName)), len(trim(ri!lastName)) > 0)
          ),
          and(not(isnull(ri!sovId)), len(trim(ri!sovId)) > 0)
        ),
        ", ",
        ""
      ),
      if(
        and(not(isnull(ri!sovId)), len(trim(ri!sovId)) > 0),
        concat("sovId: \"", ri!sovId, "\""),
        ""
      ),
      "}) { entities { addresses { address_source address_line_1 address_line_2 address_line_3 city state postal_code country } sov_id client_type record_type full_name government_id date_of_birth date_of_death gender_code password_question password portal_registration portal_username email_addresses { email_type address } phone_numbers { phone_type area_code dial_number } contracts { transaction_contracts { contract_number delivery issue_date } } preferences account_count product source_system status job_name tax_qualification role restrictions_and_alerts primary_servicing_producer jointId } } }"
    )
  }
)
