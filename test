a!toJson(
  {
    query: "query MyQuery($firstName: String, $lastName: String, $ssn: String, $sovId: String) { getEntities(firstName: $firstName, lastName: $lastName, ssn: $ssn, sovId: $sovId) { addresses { address_source address_line_1 address_line_2 address_line_3 city state postal_code country } sov_id client_type record_type full_name government_id date_of_birth date_of_death gender_code password_question password portal_registration portal_username email_addresses { email_type address } phone_numbers { phone_type area_code dial_number } contracts { transaction_contracts { contract_number delivery issue_date } } preferences account_count product source_system status job_name tax_qualification role restrictions_and_alerts primary_servicing_producer jointId } }",
    variables: a!fromJson(
      a!toJson(
        reject(
          {
            if(
              and(not(isnull(ri!firstName)), len(trim(ri!firstName)) > 0),
              { firstName: ri!firstName },
              null
            ),
            if(
              and(not(isnull(ri!lastName)), len(trim(ri!lastName)) > 0),
              { lastName: ri!lastName },
              null
            ),
            if(
              and(not(isnull(ri!ssn)), len(trim(ri!ssn)) > 0),
              { ssn: ri!ssn },
              null
            ),
            if(
              and(not(isnull(ri!sovId)), len(trim(ri!sovId)) > 0),
              { sovId: ri!sovId },
              null
            )
          },
          isnull(_)
        ),
        removeNullOrEmptyFields: true()
      )
    )
  },
  removeNullOrEmptyFields: true()
)
